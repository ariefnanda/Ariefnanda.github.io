<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOBA Mini - Tower Defense</title>
    
    <style>
        /* CSS untuk tampilan game */
        body {
            font-family: 'Consolas', monospace;
            text-align: center;
            background-color: #2c3e50; /* Warna biru gelap */
            color: #ecf0f1;
            padding: 20px;
        }

        .container {
            width: fit-content;
            margin: 0 auto;
            border: 5px solid #e74c3c; /* Border Merah */
            background-color: #34495e;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        canvas {
            display: block;
        }

        #info {
            margin-top: 15px;
            font-size: 1.1em;
        }

        #scoreDisplay {
            color: #f1c40f; /* Kuning Emas */
            font-weight: bold;
        }
        
        #baseHpDisplay {
            color: #2ecc71; /* Hijau Emerald */
            font-weight: bold;
        }
        
        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #gameOverScreen button {
            padding: 12px 25px;
            font-size: 1.2em;
            margin-top: 25px;
            background-color: #3498db; /* Biru */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        #gameOverScreen button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>

    <div class="container">
        <canvas id="gameCanvas" width="800" height="150"></canvas> 
    </div>

    <div id="info">
        HP Markas: <span id="baseHpDisplay">100</span> | Musuh Hancur: <span id="scoreDisplay">0</span>
        <br>
        Tujuan: Hancurkan Minion musuh sebelum mereka menghancurkan markas Anda.
    </div>

    <div id="gameOverScreen">
        <h1>MARKAS HANCUR! (GAME OVER)</h1>
        <p>Anda berhasil bertahan dari <span id="finalScore">0</span> Minion.</p>
        <button onclick="startGame()">Mulai Lagi</button>
    </div>

    <script>
        // Logika Game JavaScript
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const baseHpDisplay = document.getElementById('baseHpDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScore = document.getElementById('finalScore');

        // --- Variabel Game ---
        let gameLoopId;
        let isGameOver = false;
        let score = 0;
        
        // Objek Markas (Base)
        let base = {
            x: 20,
            y: canvas.height / 2,
            width: 15,
            height: 100,
            hp: 100,
            maxHp: 100,
            color: '#2ecc71' // Hijau
        };
        
        // Objek Turret (Pemain)
        let turret = {
            x: 100,
            y: canvas.height / 2,
            size: 10,
            range: 300,
            fireRate: 500, // ms
            lastShot: 0,
            color: '#3498db' // Biru
        };
        
        let minions = [];
        let bullets = [];
        
        let minionSpawnTimer = 0;
        const SPAWN_DELAY = 1500; // Minion muncul setiap 1.5 detik

        // --- Fungsi Utama Game ---

        function startGame() {
            // Reset semua variabel
            isGameOver = false;
            score = 0;
            base.hp = base.maxHp;
            minions = [];
            bullets = [];
            minionSpawnTimer = 0;
            turret.lastShot = 0;
            
            gameOverScreen.style.display = 'none';
            
            if (gameLoopId) {
                cancelAnimationFrame(gameLoopId);
            }
            gameLoopId = requestAnimationFrame(gameLoop);
            updateDisplay();
        }

        function updateDisplay() {
            baseHpDisplay.textContent = base.hp;
            scoreDisplay.textContent = score;
        }

        function drawBase() {
            ctx.fillStyle = base.color;
            ctx.fillRect(base.x, base.y - base.height / 2, base.width, base.height);
            // Gambar HP Bar di atas markas (sederhana)
            ctx.fillStyle = 'red';
            ctx.fillRect(base.x - 5, base.y - base.height / 2 - 10, 25, 5); 
            ctx.fillStyle = 'lime';
            ctx.fillRect(base.x - 5, base.y - base.height / 2 - 10, 25 * (base.hp / base.maxHp), 5); 
        }

        function drawTurret() {
            ctx.fillStyle = turret.color;
            ctx.beginPath();
            ctx.arc(turret.x, turret.y, turret.size, 0, Math.PI * 2);
            ctx.fill();
        }

        // --- Minion ---
        function spawnMinion() {
            minions.push({
                x: canvas.width,
                y: canvas.height / 2,
                size: 8,
                speed: 1, 
                damage: 5,
                hp: 10,
                color: '#e74c3c' // Merah
            });
        }

        function updateMinions() {
            for (let i = minions.length - 1; i >= 0; i--) {
                const minion = minions[i];
                minion.x -= minion.speed; // Bergerak ke kiri (menuju markas)
                
                // Cek tabrakan dengan markas
                if (minion.x - minion.size <= base.x + base.width) {
                    base.hp -= minion.damage;
                    minions.splice(i, 1); // Hancurkan minion setelah menyerang
                    updateDisplay();
                    
                    if (base.hp <= 0) {
                        endGame();
                        return;
                    }
                    continue;
                }

                // Gambar minion
                ctx.fillStyle = minion.color;
                ctx.beginPath();
                ctx.arc(minion.x, minion.y, minion.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Gambar HP Bar minion (sangat sederhana)
                ctx.fillStyle = 'red';
                ctx.fillRect(minion.x - 5, minion.y - 15, 10, 3); 
                // Karena minion hanya punya 10 HP, ini hanya visual sederhana
            }
        }

        // --- Tembakan ---
        function turretFire(target) {
            bullets.push({
                x: turret.x,
                y: turret.y,
                radius: 4,
                speed: 5,
                color: 'yellow',
                target: target // Target peluru
            });
            turret.lastShot = Date.now();
        }

        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Gerak menuju target (minion pertama)
                const target = bullet.target;
                if (!target) {
                    bullets.splice(i, 1);
                    continue;
                }
                
                const dx = target.x - bullet.x;
                const dy = target.y - bullet.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                // Normalisasi kecepatan
                bullet.x += (dx / dist) * bullet.speed;
                bullet.y += (dy / dist) * bullet.speed;

                // Gambar peluru
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- Logika Game ---
        function checkCollisions() {
            // 1. Peluru vs Minion
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                
                // Hanya perlu cek tabrakan dengan target peluru
                const target = bullet.target;
                if (!target) continue;

                const dx = bullet.x - target.x;
                const dy = bullet.y - target.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < bullet.radius + target.size / 2) {
                    // Minion tertembak! (Anggap 1 peluru = 1 hit)
                    
                    // Hancurkan minion
                    const targetIndex = minions.indexOf(target);
                    if (targetIndex > -1) {
                         minions.splice(targetIndex, 1); 
                         score += 1;
                         updateDisplay();
                    }
                    
                    bullets.splice(i, 1); // Hancurkan peluru
                }
            }
        }

        function turretLogic() {
            // Cari minion terdekat dalam jangkauan
            const target = minions.find(m => {
                const dx = m.x - turret.x;
                const dy = m.y - turret.y;
                return Math.sqrt(dx * dx + dy * dy) <= turret.range;
            });

            if (target && (Date.now() - turret.lastShot > turret.fireRate)) {
                turretFire(target);
            }
        }
        
        function endGame() {
            isGameOver = true;
            cancelAnimationFrame(gameLoopId);
            
            finalScore.textContent = score;
            // Tampilkan layar game over
            gameOverScreen.style.display = 'flex';
        }

        // --- Loop Utama Game ---
        function gameLoop(timestamp) {
            if (isGameOver) return;

            // 1. Bersihkan Canvas
            ctx.fillStyle = '#111';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Spawn Minion
            minionSpawnTimer += 16.67; // Approx 60 FPS
            if (minionSpawnTimer >= SPAWN_DELAY) {
                spawnMinion();
                minionSpawnTimer = 0;
            }

            // 3. Logika & Update
            turretLogic();
            
            // 4. Update dan Gambar
            updateMinions();
            updateBullets();
            
            // 5. Deteksi Tabrakan
            checkCollisions();
            
            // 6. Gambar
            drawBase();
            drawTurret();

            // Loop berikutnya
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // Mulai Game saat pertama kali dimuat
        document.addEventListener('DOMContentLoaded', startGame);
    </script>
</body>
</html>
